(this.webpackJsonp=this.webpackJsonp||[]).push([["styla-cms-integration-plugin"],{"4RnA":function(e,t,n){"use strict";n.r(t);var a=n("dQuS"),s=n.n(a);const{Component:i,Mixin:o}=Shopware,{Criteria:c}=Shopware.Data;i.register("styla-account-name-settings",{template:s.a,model:{prop:"value",event:"change"},inject:["repositoryFactory"],props:{value:{required:!0}},created(){this.fetchAvailableLocales()},data:()=>({accountNames:{},languages:{},defaultAccountNameError:null}),methods:{fetchAvailableLocales(){this.repository=this.repositoryFactory.create("language");const e=new c;e.addSorting(c.sort("createdAt","ASC")),this.repository.search(e,Shopware.Context.api).then((e=>{Array.isArray(e)?this.updateLanguages(e):this.updateLanguages([]),this.checkForm()}))},updateLanguages:function(e){const t={};e.forEach((function(e){t[e.id]=e})),this.languages=t,this.updateAccountNamesList()},updateAccountNamesList:function(){let e="object"==typeof this.value?this.value:{},t={default:e.hasOwnProperty("default")?e.default:""};for(const n in this.languages)t[n]=e.hasOwnProperty(n)?e[n]:"";this.accountNames=t},onChange(){this.$emit("change",this.accountNames)},checkForm(){let e=!0;this.accountNames.hasOwnProperty("default")?""===this.accountNames.default&&(this.addDefaultAccountNameError(),e=!1):(this.addDefaultAccountNameError(),e=!1),e&&(this.defaultAccountNameError=null),this.$emit("preventSave",e)},addDefaultAccountNameError(){this.defaultAccountNameError={code:1,detail:this.$tc("styla-cms-integration-plugin.configuration.field.account_names.default.error.empty")}}}});var l=n("FZBp"),r=n.n(l);const{Component:u}=Shopware;u.register("cms-block-styla-module-content",{template:r.a});var g=n("e+K4"),d=n.n(g);n("dniG");const{Component:m}=Shopware;m.register("cms-block-styla-module-content-preview",{template:d.a}),Shopware.Service("cmsService").registerCmsBlock({name:"styla-module-content",category:"text",label:"styla-cms-integration-plugin.blocks.module-content.label",component:"cms-block-styla-module-content",previewComponent:"cms-block-styla-module-content-preview",defaultConfig:{},slots:{content:{type:"styla-module-content"}}});var p=n("BLav"),h=n.n(p);n("aSPI");const{Component:y,Mixin:f}=Shopware;y.register("cms-element-styla-module-content",{template:h.a,mixins:[f.getByName("cms-element")],created(){this.createdComponent()},methods:{createdComponent(){this.initElementConfig("styla-module-content")}}});var S=n("xh6E"),v=n.n(S);const{Component:w,Mixin:b}=Shopware;w.register("cms-element-styla-module-content-config",{template:v.a,mixins:[b.getByName("cms-element")],created(){this.createdComponent()},methods:{createdComponent(){this.initElementConfig("styla-module-content")}}});var C=n("TlAQ"),z=n.n(C);n("zapo");const{Component:A}=Shopware;A.register("cms-element-styla-module-content-preview",{template:z.a}),Shopware.Service("cmsService").registerCmsElement({name:"styla-module-content",label:"styla-cms-integration-plugin.element.module-content.label",component:"cms-element-styla-module-content",configComponent:"cms-element-styla-module-content-config",previewComponent:"cms-element-styla-module-content-preview",defaultConfig:{slotId:{source:"static",value:"",required:!0}}});var N=n("AETE"),P=n("r5uX"),k=n.n(P);const{Component:_,Mixin:x}=Shopware,{Criteria:$}=Shopware.Data,{date:E}=Shopware.Utils.format;_.register("styla-cms-integration-page-listing",{template:k.a,inject:["repositoryFactory","stylaPageApiService","stylaSynchronizationApiService","systemConfigApiService"],mixins:[x.getByName("notification")],data:()=>({repository:null,pages:null,lastSuccessSynchronizationDate:null,scheduleSynchronizationSuccess:!1,scheduleSynchronizationProcessing:!1}),metaInfo(){return{title:this.$createTitle()}},computed:{columns(){return this.getColumns()}},created(){this.createdComponent()},methods:{createdComponent(){this.repository=this.repositoryFactory.create("styla_cms_page"),this.domainsRepository=this.repositoryFactory.create("sales_channel_domain");let e=new $;e.addSorting($.sort("createdAt","ASC")),e.addFilter($.equals("salesChannel.typeId","8a243080f92e4c719546314b577cf82b"));let t=this.domainsRepository.search(e,Shopware.Context.api);t.then((e=>{this.domainsList=e}));let n=this.systemConfigApiService.getValues("StylaCmsIntegrationPlugin");n.then((e=>{this.settings=e}));let a=null,s=this.repository.search(new $,Shopware.Context.api);s.then((e=>{a=e})),Promise.all([s,n,t]).then((()=>{this.pages=a})),this.stylaSynchronizationApiService.getLastSuccessSynchronizationDate().then((e=>{e.data.result?this.lastSuccessSynchronizationDate=E(e.data.result,{hour:"2-digit",minute:"2-digit"}):this.lastSuccessSynchronizationDate=this.$tc("styla-cms-integration-plugin.actions.get-last-success-date.not_available")})).catch((e=>{console.error("Failed to get last success synchronization date",e),this.createNotificationError({message:this.$tc("styla-cms-integration-plugin.actions.get-last-success-date.message.failed")})}))},getColumns(){return[{property:"title",label:this.$tc("styla-cms-integration-plugin.page.listing.grid.column.title"),allowResize:!0,primary:!0},{property:"path",label:this.$tc("styla-cms-integration-plugin.page.listing.grid.column.path"),allowResize:!0},{property:"accountName",label:this.$tc("styla-cms-integration-plugin.page.listing.grid.column.account-name"),allowResize:!0},{property:"createdAt",label:this.$tc("styla-cms-integration-plugin.page.listing.grid.column.created-at"),allowResize:!0}]},scheduleSynchronization(){this.stylaPageApiService.scheduleSynchronization().then(function(e){e.data.isScheduled?this.createNotificationSuccess({message:this.$tc("styla-cms-integration-plugin.actions.schedule-pages-synchronization.message.success")}):"SYNCHRONIZATION_IS_ALREADY_RUNNING"===e.data.errorCode?this.createNotificationWarning({message:this.$tc("styla-cms-integration-plugin.actions.schedule-pages-synchronization.message.is-running")}):this.createNotificationWarning({message:this.$tc("styla-cms-integration-plugin.actions.schedule-pages-synchronization.message.was-not-scheduled")})}.bind(this)).catch(function(e){void 0!==e.response.data.errorCode&&console.error("Failed to schedule styla pages synchronization, error code: "+e.response.data.errorCode),this.createNotificationError({message:this.$tc("styla-cms-integration-plugin.actions.schedule-pages-synchronization.message.failed")})}.bind(this))},refreshPageDetails(e){const t=this.stylaPageApiService.refreshPageDetails(e.id);this.createNotificationInfo({message:this.$tc("styla-cms-integration-plugin.actions.refresh-page-details.message.scheduled")}),t.then(function(e){e.data.isSuccess?this.createNotificationSuccess({message:this.$tc("styla-cms-integration-plugin.actions.refresh-page-details.message.success")}):"PAGE_NOT_FOUND"===e.data.errorCode?this.createNotificationWarning({message:this.$tc("styla-cms-integration-plugin.actions.refresh-page-details.message.page-not-found")}):this.createNotificationError({message:this.$tc("styla-cms-integration-plugin.actions.refresh-page-details.failed")})}.bind(this)).catch(function(e){void 0!==e.response.data.errorCode&&console.error("Failed to refresh styla page details, error code: "+e.response.data.errorCode),this.createNotificationError({message:this.$tc("styla-cms-integration-plugin.actions.refresh-page-details.message.failed")})}.bind(this))},computePathLink(e){if(0===this.domainsList.length)return null;if(this.pagesPathHashMap&&this.pagesPathHashMap[e.id])return this.pagesPathHashMap[e.id];let t=null;const n=this.settings["StylaCmsIntegrationPlugin.config.accountNames"];for(let a in n)if(e.accountName===n[a]){t=a;break}let a=null;t&&"default"!==t&&(a=this.domainsList.find((e=>e.languageId===t))),a||(a=this.domainsList[0]);let s=""+e.path;const i=a.url.replace(/\/$/,"")+"/"+s.replace(/^\//,"");return this.pagesPathHashMap||(this.pagesPathHashMap={}),this.pagesPathHashMap[e.id]=i,i},resetScheduleSynchronizationState(){this.scheduleSynchronizationSuccess=!1,this.scheduleSynchronizationProcessing=!1}}});const{Module:L}=Shopware;L.register("styla-cms-integration",{type:"plugin",name:"styla-cms-integration",title:"styla-cms-integration-plugin.page.listing.title",description:"styla-cms-integration-plugin.page.listing.description",color:"#ffd53d",icon:"small-default-stack-line2",snippets:{"en-GB":N},routes:{"pages-list":{component:"styla-cms-integration-page-listing",path:"styla/page"}},navigation:[{id:"styla-cms-integration-general",label:"styla-cms-integration-plugin.menu.title",color:"#ffd53d",icon:"small-default-stack-line2",parent:"sw-content",position:100},{label:"styla-cms-integration-plugin.page.listing.title",color:"#77ff3d",icon:"small-default-stack-line2",path:"styla.cms.integration.pages-list",parent:"styla-cms-integration-general",position:100}]});var D=class{constructor(e,t){this.httpClient=e,this.loginService=t,this.name="stylaPageApiService"}scheduleSynchronization(){const e=this.getHeaders();return this.httpClient.post("/styla/page/_action/schedule-pages-synchronization",{},{headers:e})}refreshPageDetails(e){const t=this.getHeaders();return this.httpClient.post("/styla/page/_action/refresh-details/"+e,{},{headers:t})}getHeaders(){return{Accept:"application/json",Authorization:`Bearer ${this.loginService.getToken()}`,"Content-Type":"application/json"}}};Shopware.Service().register("stylaPageApiService",(e=>{const t=Shopware.Application.getContainer("init");return new D(t.httpClient,e.loginService)}));var I=class{constructor(e,t){this.httpClient=e,this.loginService=t,this.name="stylaPageApiService"}getLastSuccessSynchronizationDate(){const e=this.getHeaders();return this.httpClient.get("/styla/synchronization/page/_action/get_last_success_date_time",{},{headers:e})}getHeaders(){return{Accept:"application/json",Authorization:`Bearer ${this.loginService.getToken()}`,"Content-Type":"application/json"}}};Shopware.Service().register("stylaSynchronizationApiService",(e=>{const t=Shopware.Application.getContainer("init");return new I(t.httpClient,e.loginService)}))},AETE:function(e){e.exports=JSON.parse('{"styla-cms-integration-plugin":{"configuration":{"field":{"account_names":{"default":{"label":"Default account name","error":{"empty":"Default account name is required"}},"language_specific_account_name":{"label":"{name} account name"}}}},"blocks":{"module-content":{"label":"Styla Modular Content"}},"element":{"module-content":{"text":"Styla Modular Content, id: \\"{id}\\"","label":"Styla Modular Content","configuration":{"slot-id":{"label":"Slot Id (assigned at https://editor.styla.com/)"}}}},"page":{"listing":{"title":"Styla Pages","description":"List of Styla Pages","grid":{"column":{"title":"Page title","path":"Page path","account-name":"Account name","created-at":"Created at"}}}},"actions":{"schedule-pages-synchronization":{"button":{"label":"Schedule pages synchronization"},"message":{"success":"Pages synchronization scheduled","failed":"Failed to schedule pages synchronization","is-running":"Pages synchronization was not scheduled because another synchronization is already running","was-not-scheduled":"Pages synchronization was not scheduled"}},"refresh-page-details":{"button":{"label":"Refresh page details"},"message":{"success":"Page details refreshed","failed":"Failed to refresh page details","page-not-found":"Page with such name was not found. Please schedule pages synchronization (button above)","scheduled":"Page details refresh scheduled"}},"get-last-success-date":{"not_available":"N/A","text":"Last successful synchronization: \\"{dateTime}\\"","message":{"failed":"Failed to fetch last successful synchronization date"}}},"menu":{"title":"Styla CMS"}}}')},BLav:function(e,t){e.exports="<div class=\"cms-element-styla-module-content\">\n    <h2>\n        {{ $tc('styla-cms-integration-plugin.element.module-content.text', 0, {'id': element.config.slotId.value}) }}\n    </h2>\n</div>\n"},COz6:function(e,t,n){},FZBp:function(e,t){e.exports='<div class="cms-block-styla-module-content">\n    <slot name="content">\n    </slot>\n</div>\n'},TlAQ:function(e,t){e.exports='<div class="cms-element-styla-module-content-preview">\n    <img class="cms-element-styla-module-content-preview-image" :src="\'stylacmsintegrationplugin/administration/static/img/shopware-6-styla-module.png\' | asset"/>\n</div>\n'},Z8dF:function(e,t,n){},aSPI:function(e,t,n){var a=n("Z8dF");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);(0,n("SZ7m").default)("12502387",a,!0,{})},dQuS:function(e,t){e.exports='<div class="styla-cms-integration-account-name-settings">\n    <div class="styla-cms-integration-account-name-settings__content">\n        <sw-container>\n            <template v-for="(accountName, languageId) in accountNames">\n                <sw-field v-if="languageId === \'default\'" v-model="accountNames[languageId]"\n                          :label="$tc(\'styla-cms-integration-plugin.configuration.field.account_names.default.label\')"\n                          @change="onChange"\n                          @blur="checkForm"\n                          :error="defaultAccountNameError" required\n                >\n                </sw-field>\n                <sw-field v-else\n                          v-model="accountNames[languageId]"\n                          :label="$tc(\'styla-cms-integration-plugin.configuration.field.account_names.language_specific_account_name.label\', 0, {name: languages[languageId].name})"\n                          @change="onChange"\n                >\n                </sw-field>\n            </template>\n        </sw-container>\n    </div>\n</div>\n'},dniG:function(e,t,n){var a=n("COz6");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);(0,n("SZ7m").default)("dccf75ba",a,!0,{})},"e+K4":function(e,t){e.exports='<div>\n    <img class="cms-block-styla-module-content-preview-image" :src="\'stylacmsintegrationplugin/administration/static/img/shopware-6-styla-module.png\' | asset"/>\n</div>\n'},ibkk:function(e,t,n){},r5uX:function(e,t){e.exports='{% block styla_pages_listing %}\n    <sw-page class="overdose-contact-list">\n        <template #smart-bar-actions> {# slots check vue.js documentation #}\n            <div v-if="lastSuccessSynchronizationDate" style="margin-top: 10px">\n                <sw-label variant="info" :dismissable="false">\n                    {{ $tc(\'styla-cms-integration-plugin.actions.get-last-success-date.text\', 0, {\'dateTime\': lastSuccessSynchronizationDate}) }}\n                </sw-label>\n            </div>\n            <sw-button-process variant="ghost"\n                               :isLoading="scheduleSynchronizationProcessing"\n                               :processSuccess="scheduleSynchronizationSuccess"\n                               @process-finish="resetScheduleSynchronizationState"\n                               @click="scheduleSynchronization"\n            >\n                {{ $tc(\'styla-cms-integration-plugin.actions.schedule-pages-synchronization.button.label\') }}\n            </sw-button-process>\n        </template>\n        <template #content>\n            <sw-entity-listing\n                v-if="pages"\n                :items="pages"\n                :repository="repository"\n                :showSelection="false"\n                :allowColumnEdit="false"\n                :allowDelete="false"\n                :allowEdit="false"\n                :columns="columns">\n                <template #actions="{ item }">\n                    <sw-context-menu-item @click="refreshPageDetails(item)">\n                        {{ $tc(\'styla-cms-integration-plugin.actions.refresh-page-details.button.label\') }}\n                    </sw-context-menu-item>\n                </template>\n\n                <template v-slot:column-path="{item, column, url}">\n                    <a v-bind:href="computePathLink(item)" v-if="computePathLink(item)" target="_blank"> {{ computePathLink(item) }} </a>\n                    <span v-else>{{ item.path }}</span>\n                </template>\n            </sw-entity-listing>\n        </template>\n    </sw-page>\n{% endblock %}\n'},xh6E:function(e,t){e.exports='<sw-field v-model="element.config.slotId.value"\n          :label="$tc(\'styla-cms-integration-plugin.element.module-content.configuration.slot-id.label\')">\n</sw-field>\n'},zapo:function(e,t,n){var a=n("ibkk");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);(0,n("SZ7m").default)("038175dc",a,!0,{})}},[["4RnA","runtime","vendors-node"]]]);